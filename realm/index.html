<!doctype html>
<html lang="en" id="top">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Realm | LifeSteal SMP</title>

    <meta name="robots" content="index,follow" />
    <link rel="canonical" href="https://lifestealsmp.com/realm/" />
    <link rel="icon" href="../favicon.ico" sizes="any" />

    <style>
      :root {
        --bg: #0c0c0c;
        --surface: #151515;
        --surface-light: #1c1c1c;
        --text: #ffffff;
        --muted: #b3b3b3;
        --accent: #ff2e2e;
        --accentHover: #ff4d4d;
        --border: #242424;
      }

      * { box-sizing: border-box; }
      html, body { height: 100%; }

      body {
        margin: 0;
        background: var(--bg);
        color: var(--text);
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, Noto Sans,
          "Apple Color Emoji", "Segoe UI Emoji";
      }

      a { color: inherit; text-decoration: none; }

      .container {
        width: 100%;
        max-width: 1100px;
        margin: 0 auto;
        padding: 12px 16px;
      }

      header {
        background: var(--surface);
        border-bottom: 1px solid var(--border);
        position: sticky;
        top: 0;
        z-index: 1000;
      }

      .topbar {
        display: grid;
        grid-template-columns: auto 1fr auto;
        align-items: center;
        column-gap: 14px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
        min-width: 0;
      }

      .logo {
        width: 34px;
        height: 34px;
        object-fit: contain;
        flex: 0 0 auto;
      }

      .brandtext {
        display: flex;
        flex-direction: column;
        line-height: 1.05;
        gap: 1px;
        min-width: 0;
        align-items: flex-start;
        text-align: left;
        width: max-content;
      }

      .brandtitle {
        font-weight: 750;
        letter-spacing: -0.03em;
        white-space: nowrap;
        width: max-content;
      }

      .brandsub {
        font-size: 11px;
        font-weight: 500;
        color: var(--muted);
        margin-top: -2px;
        white-space: nowrap;
        width: 100%;
      }

      .nav-links {
        display: flex;
        align-items: center;
        gap: 20px;
        justify-content: center;
      }

      .nav-links a {
        font-size: 14px;
        font-weight: 600;
        color: var(--muted);
      }
      .nav-links a:hover { color: var(--text); }

      .nav-links a.active {
        color: var(--text);
        position: relative;
      }
      .nav-links a.active::after {
        content: "";
        position: absolute;
        left: 0;
        right: 0;
        bottom: -8px;
        height: 2px;
        background: var(--accent);
        border-radius: 2px;
      }

      .nav-right {
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: flex-end;
      }

      .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        height: 40px;
        padding: 0 14px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: var(--surface-light);
        color: var(--text);
        font-weight: 600;
        font-size: 14px;
        cursor: pointer;
      }
      .btn:hover { background: #222222; }

      .btn-primary {
        background: var(--accent);
        color: #fff;
        border: none;
      }
      .btn-primary:hover { background: var(--accentHover); }

      .pill {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 6px 10px;
        border-radius: 999px;
        background: var(--surface-light);
        border: 1px solid var(--border);
        color: var(--muted);
        font-size: 12px;
        font-weight: 600;
        line-height: 1;
        white-space: nowrap;
      }

      #online-pill { gap: 6px; }

      .pill-text {
        display: grid;
        grid-auto-rows: min-content;
        justify-items: center;
        row-gap: 2px;
        line-height: 1.05;
      }

      .pill-topline {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        justify-content: center;
        min-width: 88px;
      }

      .pill-sub {
        font-size: 11px;
        font-weight: 700;
        color: var(--text);
        opacity: 0.92;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
        background: #6b6b6b;
        flex: 0 0 auto;
      }
      #online-pill[data-state="online"] .status-dot { background: #22c55e; }
      #online-pill[data-state="offline"] .status-dot { background: #ef4444; }
      #online-pill[data-state="unknown"] .status-dot { background: #6b6b6b; }

      #playercount {
        display: inline-block;
        text-align: left;
      }

      .pixel-icon {
        width: 18px;
        height: 18px;
        display: block;
        flex: 0 0 auto;
        color: var(--muted);
      }
      .pill:hover .pixel-icon { color: var(--text); }

      .discord-icon {
        width: 18px;
        height: 18px;
        display: block;
        flex: 0 0 auto;
        color: var(--muted);
      }
      .pill:hover .discord-icon { color: var(--text); }

      main {
        padding: 18px 0 28px;
      }

      .card {
        background: var(--surface);
        border-radius: 14px;
        padding: 20px;
        border: 1px solid var(--border);
      }

      .realm-wrap {
        width: 100%;
        margin: 0 auto;
        display: grid;
        place-items: center;
      }

      .realm-stack {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        text-align: center;
        max-width: 360px;
        padding: 8px;
      }

      .realm-title {
        margin: 0;
        font-size: 28px;
        font-weight: 700;
        color: #ffffff;
      }

      .realm-logo { max-width: 160px; }

      .realm-join {
        padding: 12px 20px;
        font-size: 20px;
        font-weight: 600;
        border-radius: 8px;
        border: 1px solid #000;
        background: #f2f2f2;
        color: #000;
        cursor: pointer;
      }

      .realm-hint {
        font-size: 14px;
        color: #cfcfcf;
        line-height: 1.45;
      }

      .realm-code {
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        color: #ffffff;
        user-select: all;
      }

      @media (max-height: 680px) {
        .realm-stack { gap: 10px; }
        .realm-title { font-size: 22px; }
        .realm-logo { max-width: 160px; }
        .realm-join { font-size: 16px; padding: 9px 16px; }
        .realm-hint { font-size: 12px; }
      }

      @media (max-width: 820px) {
        .nav-links { display: none; }
        .topbar { grid-template-columns: 1fr auto; }
        .nav-right .pill { display: none; }
        .nav-right .btn { display: inline-flex; }
        .brandsub { display: none; }

        #online-pill { display: inline-flex; padding: 6px 8px; gap: 8px; }
        #online-pill .pill-sub { display: none; }
        #playercount { min-width: 0; }
      }
    </style>

    <script>
      const join = () =>
        (location.href = "minecraft://acceptRealmInvite?inviteID=4TmLrnUtSXVXj2Q/");
      window.onload = join;
    </script>
  </head>

  <body>
    <header>
      <div class="container">
        <div class="topbar">
          <a class="brand" href="../#top" aria-label="LifeSteal SMP" id="brand-link">
            <img class="logo" src="../logo.png" alt="LifeSteal SMP" onerror="this.style.display='none'" />

            <span class="brandtext">
              <span class="brandtitle">LifeSteal SMP</span>
              <span class="brandsub">Java &amp; Bedrock</span>
            </span>

            <span class="pill" id="online-pill" data-state="unknown" title="Online players" role="link" tabindex="0">
              <svg class="pixel-icon" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path fill="currentColor" d="M0 256a256 256 0 1 1 512 0A256 256 0 1 1 0 256zM188.3 147.1c-7.6 4.2-12.3 12.3-12.3 20.9V344c0 8.7 4.7 16.7 12.3 20.9s16.8 4.1 24.3-.5l144-88c7.1-4.4 11.5-12.1 11.5-20.5s-4.4-16.1-11.5-20.5l-144-88c-7.4-4.5-16.7-4.7-24.3-.5z" />
              </svg>

              <span class="pill-text">
                <span class="pill-topline">
                  <span class="status-dot" aria-hidden="true"></span>
                  <span id="playercount">…</span>
                </span>
                <span class="pill-sub">Play Now</span>
              </span>
            </span>
          </a>

          <nav class="nav-links">
            <a href="../#top">Home</a>
            <a href="../realm/" class="active">Realm</a>
            <a href="../vote/">Vote</a>
            <a href="https://discord.gg/lifestealsmp" target="_blank" rel="noreferrer">Discord</a>
          </nav>

          <div class="nav-right">
            <a class="pill" id="discord-pill" href="https://discord.gg/lifestealsmp" target="_blank" rel="noreferrer" title="Discord">
              <svg class="discord-icon" viewBox="0 0 640 512" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
                <path fill="currentColor" d="M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6a447.848,447.848,0,0,0-134.426,0a309.541,309.541,0,0,0-15.135-30.6a1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588a321.173,321.173,0,0,1-45.868-21.853a1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126a301.407,301.407,0,0,1-45.89,21.83a1.875,1.875,0,0,0-1,2.611a391.055,391.055,0,0,0,30.014,48.815a1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z" />
              </svg>

              <span class="pill-text">
                <span id="discordcount">…</span>
                <span class="pill-sub">Join Discord</span>
              </span>
            </a>

            <a class="btn btn-primary" href="https://store.lifestealsmp.com" target="_blank" rel="noreferrer">Store</a>
          </div>
        </div>
      </div>
    </header>

    <script>
      const CACHE_KEYS = {
        playerCount: "ls_playercount_v1",
        discordCount: "ls_discordcount_v1",
      };

      function getCached(key, maxAgeMs) {
        try {
          const raw = localStorage.getItem(key);
          if (!raw) return null;
          const data = JSON.parse(raw);
          if (!data || typeof data.t !== "number") return null;
          if (Date.now() - data.t > maxAgeMs) return null;
          return data.v;
        } catch {
          return null;
        }
      }

      function getStaleCache(key) {
        try {
          const data = JSON.parse(localStorage.getItem(key) || "null");
          return data && data.v ? data.v : null;
        } catch {
          return null;
        }
      }

      function setCached(key, value) {
        try {
          localStorage.setItem(key, JSON.stringify({ t: Date.now(), v: value }));
        } catch {
        }
      }

      async function loadPlayerCount() {
        const pill = document.getElementById("online-pill");
        const el = document.getElementById("playercount");

        const cached = getCached(CACHE_KEYS.playerCount, 60_000);
        if (cached && cached.text) {
          pill.dataset.state = cached.state || "unknown";
          el.textContent = cached.text;
          return;
        }

        try {
          const res = await fetch("https://api.mcsrvstat.us/2/lifestealsmp.com", { cache: "no-store" });
          if (!res.ok) throw new Error("Player count request failed");
          const data = await res.json();

          if (data && data.online && data.players && typeof data.players.online === "number") {
            pill.dataset.state = "online";
            el.textContent = data.players.online + " online";
            setCached(CACHE_KEYS.playerCount, { state: "online", text: el.textContent });
          } else {
            pill.dataset.state = "offline";
            el.textContent = "Offline";
            setCached(CACHE_KEYS.playerCount, { state: "offline", text: el.textContent });
          }
        } catch {
          pill.dataset.state = "unknown";
          const stale = getStaleCache(CACHE_KEYS.playerCount);
          if (stale && stale.text) {
            pill.dataset.state = stale.state || "unknown";
            el.textContent = stale.text;
          } else {
            el.textContent = "Unavailable";
          }
        }
      }

      async function loadDiscordMembers() {
        const el = document.getElementById("discordcount");

        const cached = getCached(CACHE_KEYS.discordCount, 60_000);
        if (cached && cached.text) {
          el.textContent = cached.text;
          return;
        }

        try {
          const res = await fetch("https://discord.com/api/v9/invites/lifestealsmp?with_counts=true", { cache: "no-store" });
          if (!res.ok) throw new Error("Discord count request failed");
          const data = await res.json();

          if (data && typeof data.approximate_member_count === "number") {
            el.textContent = data.approximate_member_count.toLocaleString() + " members";
            setCached(CACHE_KEYS.discordCount, { text: el.textContent });
          } else {
            el.textContent = "Discord";
            setCached(CACHE_KEYS.discordCount, { text: el.textContent });
          }
        } catch {
          const stale = getStaleCache(CACHE_KEYS.discordCount);
          if (stale && stale.text) {
            el.textContent = stale.text;
          } else {
            el.textContent = "Discord";
          }
        }
      }

      loadPlayerCount();
      loadDiscordMembers();

      (function () {
        const onlinePill = document.getElementById("online-pill");
        if (!onlinePill) return;

        function goJoin() {
          location.href = "../realm/";
        }

        onlinePill.addEventListener("click", (e) => {
          e.preventDefault();
          goJoin();
        });

        onlinePill.addEventListener("keydown", (e) => {
          if (e.key !== "Enter" && e.key !== " ") return;
          e.preventDefault();
          goJoin();
        });
      })();
    </script>

    <main>
      <div class="container">
        <section class="card realm-wrap">
          <div class="realm-stack">
            <h1 class="realm-title">LifeSteal SMP</h1>

            <img class="realm-logo" src="../logo.png" alt="LifeSteal SMP" onerror="this.style.display='none'" />

            <button class="realm-join" onclick="join()">Join Bedrock Realm</button>

            <div class="realm-hint">
              Java Edition:<br />
              Multiplayer → Add Server → Address: <span class="realm-code">lifestealsmp.com</span>
            </div>

            <div class="realm-hint">
              Bedrock Edition:<br />
              Realms → Add/join Realm → Join an existing Realm → <span class="realm-code">4TmLrnUtSXVXj2Q</span>
            </div>
          </div>
        </section>
      </div>
    </main>
  </body>
</html>
